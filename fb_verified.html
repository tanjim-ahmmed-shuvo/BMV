<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Order Confirmation | Facebook Profile Verify</title>
  <meta name="description" content="ফেসবুক প্রোফাইল ভেরিফাই – ধাপে ধাপে ফর্ম, স্টিকি টোটাল, ইনলাইন ভ্যালিডেশন, অটো-প্রাইস ক্যালকুলেশন।" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
  body{font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Ubuntu, Cantarell, Helvetica Neue, Arial; padding-bottom: 88px}
  @keyframes shake{10%,90%{transform:translateX(-1px)}20%,80%{transform:translateX(2px)}30%,50%,70%{transform:translateX(-4px)}40%,60%{transform:translateX(4px)}}
  .shake{animation: shake .5s ease}
  @keyframes pulseGrow{0%{transform:scale(1)}50%{transform:scale(1.1)}100%{transform:scale(1)}}
  .pulse-once{animation: pulseGrow .35s ease}

  /* Order Button Animation Styles */
  :root {
    --primary: #275EFE;
    --primary-light: #7699FF;
    --dark: #1C212E;
    --grey-dark: #3F4656;
    --grey: #6C7486;
    --grey-light: #CDD9ED;
    --white: #FFF;
    --green: #16BF78;
    --sand: #DCB773;
    --sand-light: #EDD9A9;
  }
  .order {
    appearance: none;
    border: 0;
    background: var(--dark);
    position: relative;
    height: 63px;
    width: 240px;
    padding: 0;
    outline: none;
    cursor: pointer;
    border-radius: 32px;
    -webkit-mask-image: -webkit-radial-gradient(white, black);
    mask-image: radial-gradient(white, black);
    -webkit-tap-highlight-color: transparent;
    overflow: hidden;
    transition: transform 0.3s ease;
    background-color: #1a202c;
    color: white;
    font-weight: 600;
  }
  .order span {
    --o: 1;
    position: absolute;
    left: 0;
    right: 0;
    text-align: center;
    top: 19px;
    line-height: 24px;
    color: var(--white);
    font-size: 16px;
    font-weight: 500;
    opacity: var(--o);
    transition: opacity 0.3s ease;
  }
  .order span.default {
    transition-delay: 0.3s;
  }
  .order span.success {
    --offset: 16px;
    --o: 0;
  }
  .order span.success svg {
    width: 12px;
    height: 10px;
    display: inline-block;
    vertical-align: top;
    fill: none;
    margin: 7px 0 0 4px;
    stroke: var(--green);
    stroke-width: 2;
    stroke-linecap: round;
    stroke-linejoin: round;
    stroke-dasharray: 16px;
    stroke-dashoffset: var(--offset);
    transition: stroke-dashoffset 0.3s ease;
  }
  .order:active {
    transform: scale(0.96);
  }
  .order .lines {
    opacity: 0;
    position: absolute;
    height: 3px;
    background: var(--white);
    border-radius: 2px;
    width: 6px;
    top: 30px;
    left: 100%;
    box-shadow: 15px 0 0 var(--white), 30px 0 0 var(--white), 45px 0 0 var(--white), 60px 0 0 var(--white), 75px 0 0 var(--white), 90px 0 0 var(--white), 105px 0 0 var(--white), 120px 0 0 var(--white), 135px 0 0 var(--white), 150px 0 0 var(--white), 165px 0 0 var(--white), 180px 0 0 var(--white), 195px 0 0 var(--white), 210px 0 0 var(--white), 225px 0 0 var(--white), 240px 0 0 var(--white), 255px 0 0 var(--white), 270px 0 0 var(--white), 285px 0 0 var(--white), 300px 0 0 var(--white), 315px 0 0 var(--white), 330px 0 0 var(--white);
  }
  .order .back, .order .box {
    --start: var(--white);
    --stop: var(--grey-light);
    border-radius: 2px;
    background: linear-gradient(var(--start), var(--stop));
    position: absolute;
  }
  .order .truck {
    width: 60px;
    height: 41px;
    left: 100%;
    z-index: 1;
    top: 11px;
    position: absolute;
    transform: translateX(24px);
  }
  .order .truck:before, .order .truck:after {
    --r: -90deg;
    content: '';
    height: 2px;
    width: 20px;
    right: 58px;
    position: absolute;
    display: block;
    background: var(--white);
    border-radius: 1px;
    transform-origin: 100% 50%;
    transform: rotate(var(--r));
  }
  .order .truck:before {
    top: 4px;
  }
  .order .truck:after {
    --r: 90deg;
    bottom: 4px;
  }
  .order .truck .back {
    left: 0;
    top: 0;
    width: 60px;
    height: 41px;
    z-index: 1;
  }
  .order .truck .front {
    overflow: hidden;
    position: absolute;
    border-radius: 2px 9px 9px 2px;
    width: 26px;
    height: 41px;
    left: 60px;
  }
  .order .truck .front:before, .order .truck .front:after {
    content: '';
    position: absolute;
    display: block;
  }
  .order .truck .front:before {
    height: 13px;
    width: 2px;
    left: 0;
    top: 14px;
    background: linear-gradient(var(--grey), var(--grey-dark));
  }
  .order .truck .front:after {
    border-radius: 2px 9px 9px 2px;
    background: var(--primary);
    width: 24px;
    height: 41px;
    right: 0;
  }
  .order .truck .front .window {
    overflow: hidden;
    border-radius: 2px 8px 8px 2px;
    background: var(--primary-light);
    transform: perspective(4px) rotateY(3deg);
    width: 22px;
    height: 41px;
    position: absolute;
    left: 2px;
    top: 0;
    z-index: 1;
    transform-origin: 0 50%;
  }
  .order .truck .front .window:before, .order .truck .front .window:after {
    content: '';
    position: absolute;
    right: 0;
  }
  .order .truck .front .window:before {
    top: 0;
    bottom: 0;
    width: 14px;
    background: var(--dark);
  }
  .order .truck .front .window:after {
    width: 14px;
    top: 7px;
    height: 4px;
    position: absolute;
    background: rgba(255, 255, 255, 0.14);
    transform: skewY(14deg);
    box-shadow: 0 7px 0 rgba(255, 255, 255, 0.14);
  }
  .order .truck .light {
    width: 3px;
    height: 8px;
    left: 83px;
    transform-origin: 100% 50%;
    position: absolute;
    border-radius: 2px;
    transform: scaleX(0.8);
    background: #f0dc5f;
  }
  .order .truck .light:before {
    content: '';
    height: 4px;
    width: 7px;
    opacity: 0;
    transform: perspective(2px) rotateY(-15deg) scaleX(0.94);
    position: absolute;
    transform-origin: 0 50%;
    left: 3px;
    top: 50%;
    margin-top: -2px;
    background: linear-gradient(90deg, #f0dc5f, rgba(240, 220, 95, 0.7), rgba(240, 220, 95, 0));
  }
  .order .truck .light.top {
    top: 4px;
  }
  .order .truck .light.bottom {
    bottom: 4px;
  }
  .order .box {
    --start: var(--sand-light);
    --stop: var(--sand);
    width: 21px;
    height: 21px;
    right: 100%;
    top: 21px;
  }
  .order .box:before, .order .box:after {
    content: '';
    top: 10px;
    position: absolute;
    left: 0;
    right: 0;
  }
  .order .box:before {
    height: 3px;
    margin-top: -1px;
    background: rgba(0, 0, 0, 0.1);
  }
  .order .box:after {
    height: 1px;
    background: rgba(0, 0, 0, 0.15);
  }
  .order.animate .default {
    --o: 0;
    transition-delay: 0s;
  }
  .order.animate .success {
    --offset: 0;
    --o: 1;
    transition-delay: 7s;
  }
  .order.animate .success svg {
    transition-delay: 7.3s;
  }
  .order.animate .truck {
    animation: truck 10s ease forwards;
  }
  .order.animate .truck:before {
    animation: door1 2.4s ease forwards 0.3s;
  }
  .order.animate .truck:after {
    animation: door2 2.4s ease forwards 0.6s;
  }
  .order.animate .truck .light:before, .order.animate .truck .light:after {
    animation: light 10s ease forwards;
  }
  .order.animate .box {
    animation: box 10s ease forwards;
  }
  .order.animate .lines {
    animation: lines 10s ease forwards;
  }
  @keyframes truck {
    10%, 30% {
      transform: translateX(-164px);
    }
    40% {
      transform: translateX(-104px);
    }
    60% {
      transform: translateX(-224px);
    }
    75%, 100% {
      transform: translateX(24px);
    }
  }
  @keyframes lines {
    0%, 30% {
      opacity: 0;
      transform: scaleY(0.7) translateX(0);
    }
    35%, 65% {
      opacity: 1;
    }
    70% {
      opacity: 0;
    }
    100% {
      transform: scaleY(0.7) translateX(-400px);
    }
  }
  @keyframes light {
    0%, 30% {
      opacity: 0;
      transform: perspective(2px) rotateY(-15deg) scaleX(0.88);
    }
    40%, 100% {
      opacity: 1;
      transform: perspective(2px) rotateY(-15deg) scaleX(0.94);
    }
  }
  @keyframes door1 {
    30%, 50% {
      transform: rotate(32deg);
    }
  }
  @keyframes door2 {
    30%, 50% {
      transform: rotate(-32deg);
    }
  }
  @keyframes box {
    8%, 10% {
      transform: translateX(40px);
      opacity: 1;
    }
    25% {
      transform: translateX(112px);
      opacity: 1;
    }
    26% {
      transform: translateX(112px);
      opacity: 0;
    }
    27%, 100% {
      transform: translateX(0px);
      opacity: 0;
    }
  }
  
  /* Modal for Thank You message */
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 100;
  }
  .modal-content {
    background-color: white;
    padding: 24px;
    border-radius: 1rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    max-width: 90%;
    text-align: center;
  }
  /* Custom class for the logo shadow */
  .logo-shadow {
    filter: drop-shadow(1px 1px 0.5px rgba(0, 0, 0, 1));
  }
  </style>

  <script>
    !(function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
    n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)})(window, document,'script','https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '1091993236371736');
    fbq('track', 'PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=1091993236371736&ev=PageView&noscript=1"/></noscript>

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-BLZ8WKLXK5"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-BLZ8WKLXK5');
  </script>
</head>
<body class="min-h-screen bg-slate-50">
  <header class="max-w-3xl mx-auto px-4 pt-8">
    <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
      <div class="flex items-center justify-between gap-4 flex-wrap sm:flex-nowrap">
        <div class="flex items-center gap-4 flex-1 min-w-0">
          <div>
            <div class="w-40 flex-shrink-0 flex items-center justify-center mb-2">
              <img id="logo" alt="Digifix BD Logo" class="w-full h-full object-contain logo-shadow" src="https://www.digifixbd.com/img/Photos/digifixbd%20color%20png.png"/>
            </div>
            <h1 class="text-2xl font-bold">ফেসবুক প্রোফাইল ভেরিফাই – অর্ডার</h1>
            <p class="text-slate-600 text-sm">২ ধাপে সম্পূর্ণ করুন। প্রাইস অটো-আপডেট হবে।</p>
          </div>
        </div>
        <img alt="Banner" class="w-32 h-32 rounded-lg flex-shrink-0" src="https://lh3.googleusercontent.com/d/1-lwr73i4fC3wkVn3Vy7AhQyt7J8MGOum=w600?authuser=0"/>
      </div>
      <div class="mt-4">
        <div class="w-full bg-slate-100 rounded-full h-2">
          <div id="progressBar" class="h-2 bg-slate-900 rounded-full" style="width:50%"></div>
        </div>
        <div class="mt-2 flex justify-between text-xs text-slate-600">
          <span>ধাপ ১: প্যাকেজ</span>
          <span>ধাপ ২: তথ্য</span>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-3xl mx-auto px-4 py-6" x-data>
    <form id="orderForm" class="space-y-6" novalidate>
      <section id="step1" class="bg-white rounded-2xl p-6 shadow-sm border border-slate-200 space-y-5">
        <div class="bg-emerald-50 border border-emerald-200 text-emerald-900 rounded-2xl p-4">
          <p class="font-semibold">অগ্রিম কোনো টাকা লাগবে না — অর্ডার কনফার্ম সম্পূর্ণ ফ্রি ✅</p>
          <p class="text-sm mt-1">অর্ডার কনফার্মের পর <b>০–৩০ মিনিট</b>ের মধ্যে আপনার দেওয়া নম্বরে আমরা যোগাযোগ করব। চাইলে আপনি কনফার্মের পর সরাসরি <a href="https://wa.me/16506687797" target="_blank" rel="noopener" class="underline font-medium">WhatsApp</a> / <a href="https://m.me/digifix.agency" target="_blank" rel="noopener" class="underline font-medium">Messenger</a> এও যোগাযোগ করতে পারবেন।</p>
        </div>

        <input type="hidden" name="product" value="profile" />

        <fieldset class="border border-slate-200 rounded-2xl p-4">
          <legend class="px-2 text-sm text-slate-600">মেয়াদ নির্বাচন</legend>
          <div class="grid md:grid-cols-2 gap-3">
            <label class="flex items-center gap-2"><input type="radio" name="duration" value="1m" required> ১ মাস (৳700)</label>
            <label class="flex items-center gap-2"><input type="radio" name="duration" value="2m"> ২ মাস (৳1300)</label>
          </div>
          <p class="mt-2 text-xs text-rose-600 hidden" data-err="duration">দয়া করে মেয়াদ নির্বাচন করুন</p>
        </fieldset>

        <fieldset class="border border-slate-200 rounded-2xl p-4">
          <legend class="px-2 text-sm text-slate-600">বিশেষ অফার (38৳ / $1 থাকলে)</legend>
          <label class="inline-flex items-center gap-2">
            <input type="checkbox" name="hasOffer38"> আমার প্রোফাইলে 38৳/1$ অফার আছে
          </label>
          <p class="text-xs text-slate-500 mt-2">অফার থাকলে: ১মাস ৳300, ২মাস ৳500</p>
        </fieldset>

        <fieldset class="border border-slate-200 rounded-2xl p-4">
          <legend class="px-2 text-sm text-slate-600">পাসওয়ার্ড শেয়ার করবেন?</legend>
          <div class="grid md:grid-cols-2 gap-3">
            <label class="flex items-center gap-2"><input type="radio" name="sharePass" value="yes" required> হ্যাঁ (আইডি-পাসওয়ার্ড দিবেন)</label>
            <label class="flex items-center gap-2"><input type="radio" name="sharePass" value="no"> না – কল/স্ক্রিনশেয়ার (+৳100)</label>
          </div>
          <p class="mt-2 text-xs text-rose-600 hidden" data-err="sharePass">দয়া করে একটি অপশন নির্বাচন করুন</p>
        </fieldset>

        <div class="bg-slate-50 border border-slate-200 rounded-2xl p-4 space-y-1 text-sm text-slate-600">
          <p>✅ ২ মাস একসাথে নিলে ভবিষ্যৎ রিনিউ: <b>৳499</b> (কোনো অতিরিক্ত চার্জ নেই)</p>
          <p>✅ 38৳/$1 অফার + ২ মাস নিলে ভবিষ্যৎ রিনিউ: <b>৳400</b> (অফার না থাকলেও)</p>
        </div>
        
        <div class="bg-slate-50 rounded-2xl p-4 flex items-center justify-between gap-3 shadow-inner border border-slate-200">
          <div class="min-w-0">
            <div class="text-slate-500 text-[11px] uppercase tracking-wide">মোট মূল্য</div>
            <div id="priceBreak" class="text-xs text-slate-700 truncate"></div>
          </div>
          <div class="flex items-center gap-3 shrink-0">
            <div class="text-2xl md:text-3xl font-extrabold text-slate-900">৳<span id="total">0</span></div>
          </div>
        </div>
        
        <div class="flex justify-end">
          <button id="toStep2" type="button" class="px-5 py-3 rounded-xl bg-slate-900 text-white font-semibold hover:bg-slate-800">পরের ধাপ</button>
        </div>
      </section>

      <section id="step2" class="bg-white rounded-2xl p-6 shadow-sm border border-slate-200 space-y-5 hidden">
        <div id="summaryBox" class="bg-blue-50 border border-blue-200 text-blue-900 rounded-2xl p-4 space-y-2">
            <p class="font-semibold">আপনার নির্বাচিত প্যাকেজ:</p>
            <div class="text-sm space-y-1">
                <p><b id="summary-duration"></b></p>
                <p><b id="summary-offer"></b></p>
                <p><b id="summary-share"></b></p>
            </div>
            <div class="text-right text-lg font-bold">মোট: ৳<span id="summary-total"></span></div>
        </div>
      
        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium mb-1">পূর্ণ নাম</label>
            <input required name="name" type="text" class="w-full rounded-xl border border-slate-300 focus:border-slate-500 focus:ring-slate-500" placeholder="আপনার নাম" />
            <p class="mt-1 text-xs text-rose-600 hidden" data-err="name">দয়া করে নাম লিখুন</p>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">ইমেইল (ঐচ্ছিক)</label>
            <input name="email" type="email" class="w-full rounded-xl border border-slate-300 focus:border-slate-500 focus:ring-slate-500" placeholder="name@email.com" />
            <p class="mt-1 text-xs text-rose-600 hidden" data-err="email">ইমেইল ঠিক আছে কি?</p>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">মোবাইল নম্বর</label>
            <input required name="phone" type="tel" inputmode="numeric" pattern="01[0-9]{9}" class="w-full rounded-xl border border-slate-300 focus:border-slate-500 focus:ring-slate-500" placeholder="01XXXXXXXXX" />
            <p class="mt-1 text-xs text-rose-600 hidden" data-err="phone">ফরম্যাট: 01XXXXXXXXX</p>
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">অতিরিক্ত তথ্য / পরামর্শ</label>
          <textarea name="requirements" rows="4" class="w-full rounded-xl border border-slate-300 focus:border-slate-500 focus:ring-slate-500" placeholder="যদি কিছু অতিরিক্ত তথ্য জানাতে চান লিখুন..."></textarea>
        </div>


        <div class="flex items-center justify-between gap-3">
          <button id="backTo1" type="button" class="px-5 py-3 rounded-xl bg-slate-100 text-slate-800 font-semibold hover:bg-slate-200">পেছনে</button>
          <button id="submitBtn" type="submit" class="order">
              <span class="default">অর্ডার কনফার্ম করুন</span>
              <span class="success">Order Placed<svg viewbox="0 0 12 10">
                  <polyline points="1.5 6 4.5 9 10.5 1"></polyline>
              </svg></span>
              <div class="box"></div>
              <div class="truck">
                  <div class="back"></div>
                  <div class="front">
                      <div class="window"></div>
                  </div>
                  <div class="light top"></div>
                  <div class="light bottom"></div>
              </div>
              <div class="lines"></div>
          </button>
        </div>
      </section>
    </form>
  </main>

  <div id="thankyouModal" class="hidden modal-overlay">
    <div class="modal-content p-6">
      <p class="text-sm sm:text-base text-emerald-900 font-semibold">ধন্যবাদ! আপনার অর্ডার কনফার্ম হয়েছে।</p>
      <p class="text-sm sm:text-base text-emerald-700 mt-2">আমরা <b>০–৩০ মিনিট</b>ের মধ্যে আপনার দেওয়া নম্বরে যোগাযোগ করব।</p>
      <div class="mt-6 flex flex-col sm:flex-row gap-3">
        <a id="thankMessenger" href="#" class="px-4 py-2 rounded-lg bg-slate-900 text-white font-medium hover:bg-slate-800">Messenger-এ ইনবক্স</a>
        <a id="thankWhatsApp" href="#" class="px-4 py-2 rounded-lg bg-green-600 text-white font-medium hover:bg-green-700">WhatsApp-এ চ্যাট</a>
      </div>
    </div>
  </div>
  
  <footer class="max-w-3xl mx-auto px-4 py-8 text-center text-slate-500 mt-20">
    © <span id="yr"></span> Digifix BD. All rights reserved.
    <p class="mt-1">
      <a href="https://www.digifixbd.com/privacy-and-legal.html" class="text-slate-500 underline" target="_blank">Privacy & Legal Information</a>
    </p>
  </footer>

  
<script>
    // Year in footer
    document.getElementById('yr').textContent = new Date().getFullYear();

    /* =====================
       Config
       ===================== */
    const PIXEL_ID = '1091993236371736';
    const CURRENCY = 'BDT';
    // Only set to true if a submit truly represents a paid order or confirmed purchase.
    const SEND_PURCHASE_ON_SUBMIT = false;

    // Updated URL to use the proxy worker
    const SERVER_SCRIPT_URL = 'https://telegram-proxy.tanjimbiswas99.workers.dev/send-order';

    const step1 = document.getElementById('step1');
    const step2 = document.getElementById('step2');
    const toStep2 = document.getElementById('toStep2');
    const backTo1 = document.getElementById('backTo1');
    const progressBar = document.getElementById('progressBar');
    const totalEl = document.getElementById('total');
    const form = document.getElementById('orderForm');

    // ===== Cookie helpers (for fbp/fbc) =====
    function getCookie(name){
      const m = document.cookie.match('(^|;)\\s*' + name + '\\s*=\\s*([^;]+)');
      return m ? decodeURIComponent(m.pop()) : '';
    }
    function setCookie(name, value, days){
      let expires = '';
      if(days){
        const d = new Date();
        d.setTime(d.getTime() + (days*24*60*60*1000));
        expires = '; expires=' + d.toUTCString();
      }
      document.cookie = name + '=' + encodeURIComponent(value) + expires + '; path=/; SameSite=Lax';
    }
    function ensureFbcFromFbclid(){
      const url = new URL(window.location.href);
      const fbclid = url.searchParams.get('fbclid');
      if(fbclid){
        // Format: fb.1.<ts>.<fbclid>
        const ts = Date.now();
        const value = `fb.1.${ts}.${fbclid}`;
        setCookie('_fbc', value, 90);
      }
    }
    function readFbIds(){
      ensureFbcFromFbclid();
      const fbp = getCookie('_fbp');
      const fbc = getCookie('_fbc');
      return { fbp, fbc };
    }

    // Flags to track funnel journey
    let hasInteracted = false;
    let isSubmitted = false;

    // Track user interaction with the form
    form.addEventListener('focusin', () => {
      hasInteracted = true;
    });

    // Fire abandoned checkout event if user leaves the page after interacting
    window.addEventListener('beforeunload', () => {
      if (hasInteracted && !isSubmitted) {
        const fd = new FormData(form);
        const { total, duration, hasOffer, share } = calc();
        const eventId = 'abandoned-' + (crypto.randomUUID ? crypto.randomUUID() : Date.now());
        const { fbp, fbc } = readFbIds();

        fbq('trackCustom', 'AbandonedCheckout', {
          content_name: 'Profile Verify Order',
          product: 'profile',
          duration,
          has_offer_38: hasOffer,
          share_password: share,
          price: total,
          name: fd.get('name') || '',
          email: fd.get('email') || '',
          phone: fd.get('phone') || '',
          fbp, fbc
        }, {eventID: eventId});
      }
    });

    // Custom toast notification instead of alert()
    function notify(msg){
      const t=document.createElement('div');
      t.className='fixed top-4 right-4 bg-rose-600 text-white px-4 py-2 rounded-xl shadow-lg z-[1000]';
      t.textContent=msg; document.body.appendChild(t);
      setTimeout(()=>{t.classList.add('opacity-0','transition','duration-300'); setTimeout(()=>t.remove(),300);},2000);
    }

    // Validation for Step 1
    function validateStep1(){
      const fd = new FormData(form);
      const hasDuration = !!fd.get('duration');
      const hasShare = !!fd.get('sharePass');
      const durErr = document.querySelector('[data-err="duration"]');
      const shareErr = document.querySelector('[data-err="sharePass"]');
      if(durErr){ durErr.classList.toggle('hidden', hasDuration); const fs=durErr.closest('fieldset'); if(fs){ fs.classList.toggle('border-rose-300', !hasDuration); fs.classList.toggle('ring-1', !hasDuration); fs.classList.toggle('ring-rose-300', !hasDuration);} }
      if(shareErr){ shareErr.classList.toggle('hidden', hasShare); const fs=shareErr.closest('fieldset'); if(fs){ fs.classList.toggle('border-rose-300', !hasShare); fs.classList.toggle('ring-1', !hasShare); fs.classList.toggle('ring-rose-300', !hasShare);} }
      return hasDuration && hasShare;
    }
    document.querySelectorAll('input[name="duration"], input[name="sharePass"]').forEach(el=> el.addEventListener('change', ()=>{ validateStep1(); }));

    // Function to update the summary box in Step 2
    function updateSummary(){
      const fd = new FormData(form);
      const duration = fd.get('duration');
      const hasOffer = fd.get('hasOffer38') === 'on';
      const share = fd.get('sharePass');
      const { total } = calc();

      let durationLabel = '';
      let offerLabel = '';
      let shareLabel = '';

      let durationCost;
      if (duration === '1m') {
          durationCost = hasOffer ? 300 : 700;
          durationLabel = `মেয়াদ: ১ মাস`;
      } else if (duration === '2m') {
          durationCost = hasOffer ? 500 : 1300;
          durationLabel = `মেয়াদ: ২ মাস`;
      }

      let offerCost = 0;
      if (hasOffer) {
          offerCost = (duration === '1m' ? (700 - 300) : (1300 - 500));
          offerLabel = `বিশেষ অফার: আছে`;
      } else {
          offerLabel = `বিশেষ অফার: নেই`;
      }

      let shareCost = 0;
      if (share === 'no') {
          shareCost = 100;
          shareLabel = `পাসওয়ার্ড শেয়ার: না`;
      } else {
          shareLabel = `পাসওয়ার্ড শেয়ার: হ্যাঁ`;
      }

      document.getElementById('summary-duration').textContent = `${durationLabel} (৳${durationCost})`;
      document.getElementById('summary-offer').textContent = `${offerLabel} ${hasOffer ? `(-৳${offerCost})` : ''}`;
      document.getElementById('summary-share').textContent = `${shareLabel} ${share === 'no' ? `(+৳${shareCost})` : ''}`;
      document.getElementById('summary-total').textContent = total.toString();
    }

    // Validation for Step 2
    function validateStep2() {
      const fd = new FormData(form);
      const fields = ['name', 'phone'];
      let isValid = true;
      let firstInvalidElement = null;

      fields.forEach(field => {
        const input = document.querySelector(`[name="${field}"]`);
        const errEl = document.querySelector(`[data-err="${field}"]`);
        const isFieldValid = input.checkValidity();

        if (!isFieldValid) {
          isValid = false;
          input.classList.add('border-rose-300', 'ring-1', 'ring-rose-300');
          errEl.classList.remove('hidden');
          if (!firstInvalidElement) {
            firstInvalidElement = input;
          }
        } else {
          input.classList.remove('border-rose-300', 'ring-1', 'ring-rose-300');
          errEl.classList.add('hidden');
        }
      });

      const emailInput = document.querySelector('[name="email"]');
      const emailErrEl = document.querySelector('[data-err="email"]');
      if (emailInput.value && !emailInput.checkValidity()) {
        isValid = false;
        emailInput.classList.add('border-rose-300', 'ring-1', 'ring-rose-300');
        emailErrEl.classList.remove('hidden');
        if (!firstInvalidElement) {
          firstInvalidElement = emailInput;
        }
      } else {
        emailInput.classList.remove('border-rose-300', 'ring-1', 'ring-rose-300');
        emailErrEl.classList.add('hidden');
      }

      return isValid;
    }

    // Scroll to error and shake the fieldset
    function scrollToError(key){
      const errEl = document.querySelector(`[data-err="${key}"]`);
      const target = errEl ? (errEl.closest('fieldset') || errEl) : null;
      if(target){
        target.scrollIntoView({behavior:'smooth', block:'center'});
        target.classList.add('shake');
        setTimeout(()=>target.classList.remove('shake'), 600);
      }
    }

    function go2(){
      step1.classList.add('hidden');
      step2.classList.remove('hidden');
      progressBar.style.width='100%';
      scrollTo(0,0);

      const { total, duration, hasOffer, share } = calc();
      const eventId = 'next-step-' + (crypto.randomUUID ? crypto.randomUUID() : Date.now());

      // Custom event (kept)
      fbq('trackCustom', 'PackageSelected', {
        product:'profile',
        duration,
        has_offer_38:hasOffer,
        share_password:share,
        price: total
      }, {eventID: eventId});

      // Standard event to help optimization
      fbq('track', 'InitiateCheckout', {
        contents: [{ id: 'profile', quantity: 1 }],
        content_type: 'service',
        value: total,
        currency: CURRENCY
      }, {eventID: 'ic-' + eventId});

      updateSummary();
    }

    function back1(){ step2.classList.add('hidden'); step1.classList.remove('hidden'); progressBar.style.width='50%'; scrollTo(0,0); }

    toStep2.addEventListener('click', ()=>{
      const ok = validateStep1();
      if(!ok){
        const key = firstMissingStep1();
        if(key) scrollToError(key);
        notify('দয়া করে ধাপ ১-এর অপশনগুলো নির্বাচন করুন');
        return;
      }
      go2();
    });
    backTo1.addEventListener('click', back1);

    // Messenger dynamic ref
    const messengerUsername = 'digifix.agency';
    const whatsappNumber = '16506687797'; // digits only, E.164 without + or spaces
    const thankMessenger = document.getElementById('thankMessenger');
    const thankWhatsApp = document.getElementById('thankWhatsApp');

    function messengerHref(){
      const fd = new FormData(form);
      const ref = new URLSearchParams({
        duration: fd.get('duration')||'',
        offer38: fd.get('hasOffer38')==='on' ? 'yes' : 'no',
        share: fd.get('sharePass')||''
      }).toString();
      return `https://m.me/${messengerUsername}?${ref}`;
    }

    function whatsappHref(){
      const r = calc();
      const txt = [
        'Order Confirmed: Profile Verify',
        `Duration: ${r.duration||''}`,
        `Offer38: ${r.hasOffer?'yes':'no'}`,
        `SharePass: ${r.share||''}`,
        `Total: ৳${r.total}`
      ].join('\\n');
      return `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(txt)}`;
    }

    // Price calc + renewal hint
    function calc(){
      const fd = new FormData(form);
      const duration = fd.get('duration');
      const hasOffer = fd.get('hasOffer38')==='on';
      const share = fd.get('sharePass');
      let base = 0;
      if(duration==='1m') base = hasOffer?300:700;
      if(duration==='2m') base = hasOffer?500:1300;
      if(share==='no') base += 100;
      document.getElementById('total').textContent = base.toString();
      if(totalEl){ totalEl.classList.remove('pulse-once'); void totalEl.offsetWidth; totalEl.classList.add('pulse-once'); }
      const parts=[];
      const baseTxt = duration==='1m'?(hasOffer?300:700):(hasOffer?500:1300);
      parts.push(`বেস: ৳${baseTxt}`);
      if(share==='no') parts.push('অতিরিক্ত: ৳100');
      const renewal = (duration==='2m') ? (hasOffer? 'পরবর্তী রিনিউ: ৳400' : 'পরবর্তী রিনিউ: ৳499') : '';
      if(renewal) parts.push(renewal);
      document.getElementById('priceBreak').textContent = parts.join(' | ');
      return {total: base, duration, hasOffer, share};
    }
    form.addEventListener('change', calc);
    window.addEventListener('load', calc);

    // Submit handler
    const submitBtn = document.getElementById('submitBtn');
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();

      const isStep2Valid = validateStep2();
      if (!isStep2Valid) {
        notify('দয়া করে সকল তথ্য সঠিকভাবে পূরণ করুন');
        return;
      }

      isSubmitted = true;

      // Start the button animation
      if(!submitBtn.classList.contains('animate')) {
          submitBtn.classList.add('animate');
      }
      submitBtn.disabled = true;

      const dataObj = Object.fromEntries(new FormData(form).entries());
      const { total, duration, hasOffer, share } = calc();
      const orderEventId = 'order-' + (crypto.randomUUID ? crypto.randomUUID() : (Date.now() + '_' + Math.random().toString(36).slice(2,8)));
      const { fbp, fbc } = readFbIds();

      try {
        // Prepare the message in Markdown format for the Telegram proxy
        const message = `
*নতুন অর্ডার - ফেসবুক প্রোফাইল ভেরিফাই*
----------------------------------
**প্যাকেজ**: ${duration === '1m' ? '১ মাস' : '২ মাস'}
**মোট মূল্য**: ৳${total}
**বিশেষ অফার**: ${hasOffer ? 'আছে' : 'নেই'}
**পাসওয়ার্ড শেয়ার**: ${share === 'yes' ? 'হ্যাঁ' : 'না'}
----------------------------------
**গ্রাহকের তথ্য**
**নাম**: ${dataObj.name}
**মোবাইল**: ${dataObj.phone}
**ইমেইল**: ${dataObj.email || 'দেওয়া হয়নি'}
**অতিরিক্ত তথ্য**: ${dataObj.requirements || 'নেই'}
----------------------------------
**fbp**: ${fbp || 'n/a'}
**fbc**: ${fbc || 'n/a'}
**Order ID**: ${orderEventId}
`;

        await fetch(SERVER_SCRIPT_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message })
        });

        // Simulate the button animation
        await new Promise(resolve => setTimeout(resolve, 8000));

        // === Meta Pixel Events ===
        // Lead (primary optimization signal)
        fbq('track', 'Lead', {
          content_name: 'Profile Verify Order',
          content_type: 'service',
          contents: [{ id: 'profile', quantity: 1, item_price: total }],
          value: total,
          currency: CURRENCY,
          product: 'profile',
          duration,
          has_offer_38: hasOffer,
          share_password: share,
          external_id: dataObj.phone || dataObj.email || '',
          fbp, fbc
        }, {eventID: orderEventId});

        // Optionally send Purchase if this submit truly equals a paid purchase
        if (SEND_PURCHASE_ON_SUBMIT) {
          fbq('track', 'Purchase', {
            contents: [{ id: 'profile', quantity: 1 }],
            content_type: 'service',
            value: total,
            currency: CURRENCY,
            product: 'profile',
            duration,
            has_offer_38: hasOffer,
            share_password: share,
            fbp, fbc
          }, {eventID: orderEventId});
        }

        // CompleteRegistration as a completion signal (kept)
        fbq('track','CompleteRegistration',{
          status:'submitted',
          product:'profile',
          duration,
          has_offer_38:hasOffer,
          share_password:share,
          value:total,
          currency:CURRENCY,
          fbp, fbc
        }, {eventID:orderEventId});

        // Google Analytics event tracking
        gtag('event', 'lead_generation', {
          'event_category': 'form_submission',
          'event_label': 'Profile Verify Order',
          'value': total
        });

        document.getElementById('thankyouModal').classList.remove('hidden');
        document.querySelector('main form').classList.add('hidden');
        if(thankMessenger) thankMessenger.href = messengerHref();
        if(thankWhatsApp) thankWhatsApp.href = whatsappHref();

      } catch(err){
        console.error(err);
        notify('সাবমিট করতে সমস্যা হয়েছে, একটু পর চেষ্টা করুন');
      } finally {
        submitBtn.disabled = false;
        submitBtn.classList.remove('animate');
      }
    });

    /* =====================
        Basic Test Cases (open with ?tests=1)
        ===================== */
    function setRadio(name, value){
      document.querySelectorAll(`input[name="${name}"]`).forEach(r=>{ r.checked = (r.value===value); });
    }
    function setCheckbox(name, checked){
      const el = document.querySelector(`input[name="${name}"]`); if(el) el.checked = !!checked;
    }
    function firstMissingStep1(){
      const fd = new FormData(form);
      if(!fd.get('duration')) return 'duration';
      if(!fd.get('sharePass')) return 'sharePass';
      return null;
    }

    function runTests(){
      const params = new URLSearchParams(location.search);
      if(params.get('tests')!=='1') return; // only run when explicitly requested
      console.log('%cRunning UX tests…','color:#0a0');
      const orig = Object.fromEntries(new FormData(form).entries());

      // T1: 1m, no offer, share yes => 700
      setRadio('duration','1m'); setCheckbox('hasOffer38', false); setRadio('sharePass','yes');
      let r = calc(); console.assert(r.total===700, 'T1 failed', r);

      // T2: 1m, offer, share no => 300 + 100 = 400
      setRadio('duration','1m'); setCheckbox('hasOffer38', true); setRadio('sharePass','no');
      r = calc(); console.assert(r.total===400, 'T2 failed', r);

      // T3: 2m, no offer, share no => 1300 + 100 = 1400
      setRadio('duration','2m'); setCheckbox('hasOffer38', false); setRadio('sharePass','no');
      r = calc(); console.assert(r.total===1400, 'T3 failed', r);

      // T4: 2m, offer, share yes => 500
      setRadio('duration','2m'); setCheckbox('hasOffer38', true); setRadio('sharePass','yes');
      r = calc(); console.assert(r.total===500, 'T4 failed', r);

      // T5: validation missing selections
      document.querySelectorAll('input[name="duration"]').forEach(r=> r.checked=false);
      document.querySelectorAll('input[name="sharePass"]').forEach(r=> r.checked=false);
      const ok = validateStep1(); console.assert(ok===false, 'T5 failed, should be invalid');

      // T6: first missing should be 'duration', then 'sharePass'
      let first = firstMissingStep1(); console.assert(first==='duration', 'T6a failed, first should be duration', first);
      setRadio('duration','1m');
      first = firstMissingStep1(); console.assert(first==='sharePass', 'T6b failed, first should be sharePass', first);

      // restore original selections
      setRadio('duration', orig.duration||'');
      setCheckbox('hasOffer38', orig.hasOffer38==='on');
      setRadio('sharePass', orig.sharePass||'');
      calc();
      // T7: messengerHref should include page username with params
      setRadio('duration','1m'); setCheckbox('hasOffer38', false); setRadio('sharePass','yes');
      let murl = messengerHref(); console.assert(murl.includes('m.me/digifix.agency'), 'T7 failed: messenger url', murl);

      // T8: whatsappHref should include wa.me number and total
      let wurl = whatsappHref(); console.assert(wurl.includes('wa.me/16506687797') && wurl.includes('Total'), 'T8 failed: whatsapp url', wurl);

      console.log('%cTests finished. Check assertions above.','color:#0a0');
    }
    window.addEventListener('load', runTests);

    // ===== ViewContent on initial view (after prices ready) =====
    function sendViewContentOnce(){
      if (sendViewContentOnce._sent) return;
      sendViewContentOnce._sent = true;
      const { total } = calc();
      fbq('track', 'ViewContent', {
        contents: [{ id: 'profile', quantity: 1 }],
        content_type: 'service',
        value: total || 0,
        currency: CURRENCY
      });
    }
    window.addEventListener('load', ()=>{
      // ensure fbc if fbclid present
      ensureFbcFromFbclid();
      // send ViewContent
      sendViewContentOnce();
    });
  </script>
</body>
</body>
</html>
