<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digifix BD - Gallery</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Favicons -->
    <link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg" />
    <link rel="shortcut icon" href="/favicon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="Digifix BD" />
    <link rel="manifest" href="/favicon/site.webmanifest" />
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        video::-webkit-media-controls-panel {
            background-color: rgba(0, 0, 0, 0.5);
        }
        /* Style for the modal to ensure it appears on top */
        #post-modal {
            z-index: 100;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200">

    <!-- Header -->
    <header class="bg-white dark:bg-gray-800 shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <img src="https://placehold.co/50x50/3498db/ffffff?text=D" 
                     alt="Digifix BD Logo" 
                     class="h-10 w-10 rounded-full object-cover"
                     onerror="this.onerror=null;this.src='https://placehold.co/50x50/cccccc/ffffff?text=Logo';">
                <span class="text-xl font-bold text-gray-800 dark:text-white">Digifix BD</span>
            </div>
            <a href="#" class="text-lg font-semibold text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">
                Gallery
            </a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto p-4 md:p-8">
        <div id="post-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
            <!-- Posts will be dynamically generated or placed here -->
            <!-- Post 1: Image -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden transition-transform transform hover:scale-105 duration-300" data-post-id="post_1">
                <img src="post/its-my-photo1.jpg" alt="The world in black and white" class="w-full h-100 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x400/cccccc/ffffff?text=Image+Not+Found';">
                <div class="p-5">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">The world in black and white. A mood from 08.02.2021</p>
                    <div class="flex justify-between items-center text-sm text-gray-500 dark:text-gray-400">
                        <span>👁️ 1.5k Views</span>
                        <span>📅 Aug 02, 2021</span>
                    </div>
                    <button onclick="sharePost('post_1', 'Black and White', 'The world in black and white.')" class="mt-4 w-full bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg flex items-center justify-center gap-2 transition duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-share-fill" viewBox="0 0 16 16"><path d="M11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.499 2.499 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5z"/></svg>
                        Share
                    </button>
                </div>
            </div>
            <!-- Post 2: Video -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden transition-transform transform hover:scale-105 duration-300" data-post-id="post_2">
                <video class="w-full h-56 object-cover" controls poster="https://placehold.co/600x400/e74c3c/ffffff?text=Watch+Video">
                    <source src="http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                <div class="p-5">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">A video of a typical day on a busy city street. Life is always on the move here.</p>
                    <div class="flex justify-between items-center text-sm text-gray-500 dark:text-gray-400">
                        <span>👁️ 2.8k Views</span>
                        <span>📅 Jan 04, 2022</span>
                    </div>
                    <button onclick="sharePost('post_2', 'City Life Video', 'A video of a typical day on a busy city street.')" class="mt-4 w-full bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg flex items-center justify-center gap-2 transition duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-share-fill" viewBox="0 0 16 16"><path d="M11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.499 2.499 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5z"/></svg>
                        Share
                    </button>
                </div>
            </div>
            <!-- Post 3: Image -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden transition-transform transform hover:scale-105 duration-300" data-post-id="post_3">
                <img src="post/its-my-photo2.jpg" alt="A post with a deep meaning" class="w-full h-100 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x400/cccccc/ffffff?text=Image+Not+Found';">
                <div class="p-5">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">🐰🍒𝐓𝐡𝐢𝐬 𝐚𝐛𝐮𝐭 𝐥𝐢𝐧𝐞�🍒<br>༊༎একটু আড়াল হলেই বোঝা যায় নিজের অস্তিত্ব অন্যের কাছে কতটা মূল্যহীনღ﹏🙂🦋</p>
                    <div class="flex justify-between items-center text-sm text-gray-500 dark:text-gray-400">
                        <span>👁️ 990 Views</span>
                        <span>📅 Aug 03, 2021</span>
                    </div>
                    <button onclick="sharePost('post_3', 'Aesthetic Post', 'A post with a deep meaning.')" class="mt-4 w-full bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg flex items-center justify-center gap-2 transition duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-share-fill" viewBox="0 0 16 16"><path d="M11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.499 2.499 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5z"/></svg>
                        Share
                    </button>
                </div>
            </div>
            <!-- Post 4: Image -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden transition-transform transform hover:scale-105 duration-300" data-post-id="post_4">
                <img src="post/its-my-photo3.jpg" alt="A selfie with a mirror" class="w-full h-100 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x400/cccccc/ffffff?text=Image+Not+Found';">
                <div class="p-5">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">A selfie with mirror</p>
                    <div class="flex justify-between items-center text-sm text-gray-500 dark:text-gray-400">
                        <span>👁️ 3.2k Views</span>
                        <span>📅 Aug 10, 2021</span>
                    </div>
                    <button onclick="sharePost('post_4', 'Mirror Selfie', 'A selfie with a mirror.')" class="mt-4 w-full bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg flex items-center justify-center gap-2 transition duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-share-fill" viewBox="0 0 16 16"><path d="M11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.499 2.499 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5z"/></svg>
                        Share
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white dark:bg-gray-800 mt-8 py-6 text-center">
        <p class="text-gray-600 dark:text-gray-400">&copy; 2025 Digifix BD. All rights reserved.</p>
    </footer>

    <!-- Share Notification -->
    <div id="share-notification" class="fixed bottom-5 right-5 bg-green-500 text-white py-2 px-5 rounded-lg shadow-xl opacity-0 transition-opacity duration-500">
        Link copied to clipboard!
    </div>

    <!-- Modal for displaying a single post -->
    <div id="post-modal" class="fixed inset-0 bg-black bg-opacity-75 flex justify-center items-center hidden">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden max-w-lg w-full m-4 relative">
            <!-- Close Button -->
            <button id="modal-close-btn" class="absolute top-3 right-3 text-white bg-black bg-opacity-50 rounded-full p-1 hover:bg-opacity-75 transition z-10">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-x" viewBox="0 0 16 16">
                    <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                </svg>
            </button>
            
            <!-- Modal Content Area -->
            <div id="modal-content-area" class="max-h-[90vh] overflow-y-auto">
                <!-- Content will be injected here by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc, increment } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth;

        async function main() {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                console.log("Firebase initialized and user signed in.");

                // This function will now only work if you add back the 'view-count' class to the spans
                initializePostViews(); 
                handleSharedPost(); // Check for shared links on load
            } catch (error) {
                console.error("Firebase initialization failed:", error);
            }
        }

        function initializePostViews() {
            const posts = document.querySelectorAll('.view-count[data-post-id]');
            posts.forEach(post => {
                const postId = post.dataset.postId;
                if (!postId) return;
                const docRef = doc(db, `artifacts/${appId}/public/data/posts/${postId}`);
                const viewIncrementedKey = `view_incremented_${postId}`;

                if (!sessionStorage.getItem(viewIncrementedKey)) {
                    setDoc(docRef, { views: increment(1) }, { merge: true })
                        .then(() => sessionStorage.setItem(viewIncrementedKey, 'true'))
                        .catch(error => console.error(`Error incrementing view for ${postId}:`, error));
                }

                onSnapshot(docRef, (doc) => {
                    const viewElement = document.getElementById(`views-${postId}`);
                    if (viewElement) {
                        viewElement.innerText = doc.exists() ? `👁️ ${doc.data().views.toLocaleString()} Views` : `👁️ 1 View`;
                    }
                }, (error) => {
                    console.error(`Error getting real-time views for ${postId}:`, error);
                    const viewElement = document.getElementById(`views-${postId}`);
                    if(viewElement) viewElement.innerText = '👁️ Error';
                });
            });
        }

        // --- MODAL LOGIC ---
        const modal = document.getElementById('post-modal');
        const modalContentArea = document.getElementById('modal-content-area');
        const closeModalBtn = document.getElementById('modal-close-btn');

        function openModalWithPost(postId) {
            const originalPost = document.querySelector(`[data-post-id='${postId}']`);
            if (!originalPost) {
                console.error(`Post with ID ${postId} not found.`);
                return;
            }

            const postContentClone = originalPost.cloneNode(true);
            
            const shareButtonInModal = postContentClone.querySelector('button');
            if(shareButtonInModal) shareButtonInModal.remove();

            const mediaElement = postContentClone.querySelector('img, video');
            if (mediaElement) {
                mediaElement.classList.remove('h-56');
                mediaElement.classList.add('w-full', 'max-h-[70vh]', 'object-contain');
            }
            
            modalContentArea.innerHTML = '';
            modalContentArea.appendChild(postContentClone);
            modal.classList.remove('hidden');
        }

        function closeModal() {
            modal.classList.add('hidden');
            modalContentArea.innerHTML = '';
            if (history.pushState) {
                history.pushState("", document.title, window.location.pathname + window.location.search);
            } else {
                window.location.hash = '';
            }
        }

        closeModalBtn.addEventListener('click', closeModal);
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });

        function handleSharedPost() {
            const hash = window.location.hash;
            if (hash) {
                const postId = hash.substring(1);
                setTimeout(() => openModalWithPost(postId), 500);
            }
        }

        window.addEventListener('load', main);
    </script>
    
    <script>
        // This script remains separate as it doesn't need module scope.
        async function sharePost(postId, title, text) {
            const url = `${window.location.origin}${window.location.pathname}#${postId}`;
            if (navigator.share) {
                try {
                    await navigator.share({ title, text, url });
                } catch (err) {
                    console.error('Error sharing post: ', err);
                }
            } else {
                copyToClipboard(url);
            }
        }

        function copyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                showNotification('Link copied to clipboard!');
            } catch (err) {
                console.error('Failed to copy link: ', err);
                alert('Sorry, the link could not be copied.');
            }
            document.body.removeChild(textArea);
        }

        function showNotification(message) {
            const notification = document.getElementById('share-notification');
            notification.innerText = message;
            notification.classList.remove('opacity-0');
            notification.classList.add('opacity-100');
            setTimeout(() => {
                notification.classList.remove('opacity-100');
                notification.classList.add('opacity-0');
            }, 3000);
        }
    </script>

</body>
</html>
�
