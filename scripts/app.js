// --- TRANSLATION DATA ---
const translations = {
    en: {
        pageTitle: "Digifix BD - Meta Verified, Subscriptions & Digital Services in Bangladesh",
        metaDescription: "Get Facebook Meta Verified, Netflix, YouTube Premium, VPNs, Android Rooting, and more in Bangladesh. Digifix BD offers all digital solutions at a low price. Contact Tanjim Ahmmed Shuvo.",
        navServices: "Services",
        navContact: "Contact",
        navVisitPage: "Visit Page",
        heroTitle: "Get Meta Verified",
        heroSubtitle: "Low Price, Fast Delivery. Build Your Trust & Boost Your Brand!",
        heroBtnWhatsapp: "Contact on WhatsApp",
        heroBtnMessenger: "Send a Message",
        onlineServicesTitle: "Online Services",
        fbMetaVerified: "Facebook Meta Verified",
        fbMetaVerifiedDesc: "Blue badge at a low price.",
        instaThreadsVerify: "Instagram & Threads Verify",
        pageVerify: "Page Verification",
        bmVerify: "Business Manager Verification",
        adsAccVerify: "Ads Account Verification",
        whatsappVerify: "WhatsApp Business Verification",
        runningVerify: "Running Verification",
        idUnlock: "Locked ID Unlock",
        payoutFix: "Payout Issue Fix",
        payoutFixDesc: "Transfer, Restriction, Disabled Fix.",
        paymentFix: "Payment Disabled Fix",
        paymentFixDesc: "Ads Account / Meta Payment.",
        vatSaving: "Ads VAT/TAX Saving BIN",
        adsCampaign: "Ads Campaign & Boosting",
        suspendedIdBack: "Suspended ID Recovery",
        subscriptionsTitle: "Subscriptions",
        subNetflix: "Netflix Premium",
        subTelegram: "Telegram Premium",
        subTwitter: "Twitter (X) Premium",
        subGoogleAI: "Google AI Pro",
        subChatGPT: "ChatGPT Plus (GPT-4)",
        subYoutube: "YouTube Premium",
        subWatchTime: "YT/FB Watch Time",
        subVPN: "Paid VPNs",
        subSoftware: "Paid Software",
        otherServicesTitle: "Other Digital Services",
        otherRDP: "RDP Access",
        otherCourses: "Paid Tutorials & Courses",
        otherAppDev: "Mini Android App Dev",
        otherProxy: "WIFI BDIX Bypass Proxy",
        offlineServicesTitle: "Offline (Android Only) Services",
        offlineRepair: "Dead Phone Repair",
        offlineCPU: "CPU Overclock",
        offlineRoot: "Root Any Android",
        offlineOSUpgrade: "OS Upgrade",
        offlineBootloop: "Bootloop Fix",
        offlineAnimation: "Boot Animation Change",
        offlineLock: "Lock / Unlock",
        offlineFRP: "FRP Lock Bypass",
        offlineCustomOS: "Custom OS Install",
        offlineUnsupported: "Unsupported App Install",
        offlineFlash: "Software Flash",
        offlineDelete: "Delete System Apps",
        offlineKernel: "Custom Kernel Install",
        offlineInstallOS: "Install OS on Phone",
        offlineMore: "And Many More...",
        footerTitle: "Get in Touch",
        footerSubtitle: "Follow our page for updates or contact us directly through WhatsApp or Messenger.",
        footerBtnPage: "Visit Our Page",
        footerBtnWhatsapp: "Chat on WhatsApp",
        footerBtnMessenger: "Message on Facebook",
        footerPrivacy: "Privacy & Legal Information",
        footerCopyright: "© 2025 Digifix BD. All Rights Reserved.",
        chatHeader: "AI Assistant",
        chatPlaceholder: "Type your message...",
        chatInitialQuestion: "Hello! I am the Digifix BD AI assistant. What service are you looking for today?",
        chatLiveAgentQuery: "Was this helpful? Would you like to talk to a live agent?",
        chatYes: "Yes",
        chatNo: "No",
        chatContactInfo: "Great! You can contact us directly via:",
        chatThanks: "You're welcome! Feel free to ask if you have any other questions.",
        geminiError: "Something went wrong. Please try again later.",
    },
    bn: {
        pageTitle: "Digifix BD - মেটা ভেরিফাইড, সাবস্ক্রিপশন ও ডিজিটাল সার্ভিস",
        metaDescription: "বাংলাদেশে ফেসবুক মেটা ভেরিফাইড, নেটফ্লিক্স, ইউটিউব প্রিমিয়াম, ভিপিএন, অ্যান্ড্রয়েড রুটিং এবং আরও অনেক ডিজিটাল সমাধান নিন। ডিজিফিক্স বিডি সুলভ মূল্যে সকল পরিষেবা অফার করে। তানজিম আহমেদ শুভ-এর সাথে যোগাযোগ করুন।",
        navServices: "সার্ভিসসমূহ",
        navContact: "যোগাযোগ",
        navVisitPage: "পেজ ভিজিট করুন",
        heroTitle: "মেটা ভেরিফাইড করুন",
        heroSubtitle: "সুলভ মূল্য, দ্রুত ডেলিভারি। আপনার বিশ্বাস তৈরি করুন এবং ব্র্যান্ডকে এগিয়ে নিন!",
        heroBtnWhatsapp: "WhatsApp-এ যোগাযোগ",
        heroBtnMessenger: "মেসেজ পাঠান",
        onlineServicesTitle: "অনলাইন সার্ভিসসমূহ",
        fbMetaVerified: "ফেসবুক মেটা ভেরিফাইড",
        fbMetaVerifiedDesc: "সুলভ মূল্যে ব্লু ব্যাজ।",
        instaThreadsVerify: "ইন্সটাগ্রাম ও থ্রেডস ভেরিফাই",
        pageVerify: "পেজ ভেরিফিকেশন",
        bmVerify: "বিজনেস ম্যানেজার ভেরিফিকেশন",
        adsAccVerify: "অ্যাডস অ্যাকাউন্ট ভেরিফিকেশন",
        whatsappVerify: "হোয়াটসঅ্যাপ বিজনেস ভেরিফিকেশন",
        runningVerify: "রানিং ভেরিফিকেশন",
        idUnlock: "লকড আইডি আনলক",
        payoutFix: "পে-আউট সমস্যার সমাধান",
        payoutFixDesc: "ট্রান্সফার, রেস্ট্রিকশন, ডিজেবল সমস্যার সমাধান।",
        paymentFix: "পেমেন্ট ডিজেবল সমস্যার সমাধান",
        paymentFixDesc: "অ্যাডস অ্যাকাউন্ট / মেটা পেমেন্ট।",
        vatSaving: "অ্যাডস ভ্যাট/ট্যাক্স সেভিং বিন",
        adsCampaign: "অ্যাডস ক্যাম্পেইন ও বুস্টিং",
        suspendedIdBack: "সাসপেন্ড আইডি পুনরুদ্ধার",
        subscriptionsTitle: "সাবস্ক্রিপশনসমূহ",
        subNetflix: "নেটফ্লিক্স প্রিমিয়াম",
        subTelegram: "টেলিগ্রাম প্রিমিয়াম",
        subTwitter: "টুইটার (X) প্রিমিয়াম",
        subGoogleAI: "গুগল এআই প্রো",
        subChatGPT: "চ্যাটজিপিটি প্লাস (GPT-4)",
        subYoutube: "ইউটিউব প্রিমিয়াম",
        subWatchTime: "ইউটিউব/ফেসবুক ওয়াচ টাইম",
        subVPN: "পেইড ভিপিএন",
        subSoftware: "পেইড সফটওয়্যার",
        otherServicesTitle: "অন্যান্য ডিজিটাল সার্ভিস",
        otherRDP: "আরডিপি অ্যাক্সেস",
        otherCourses: "পেইড টিউটোরিয়াল ও কোর্স",
        otherAppDev: "মিনি অ্যান্ড্রয়েড অ্যাপ ডেভলপমেন্ট",
        otherProxy: "ওয়াইফাই BDIX বাইপাস প্রক্সি",
        offlineServicesTitle: "অফলাইন সার্ভিস (শুধুমাত্র অ্যান্ড্রয়েড)",
        offlineRepair: "ডেড ফোন মেরামত",
        offlineCPU: "সিপিইউ ওভারক্লক",
        offlineRoot: "যেকোনো অ্যান্ড্রয়েড রুট",
        offlineOSUpgrade: "ওএস আপগ্রেড",
        offlineBootloop: "বুটলুপ ফিক্স",
        offlineAnimation: "বুট অ্যানিমেশন পরিবর্তন",
        offlineLock: "লক / আনলক",
        offlineFRP: "এফআরপি লক বাইপাস",
        offlineCustomOS: "কাস্টম ওএস ইনস্টল",
        offlineUnsupported: "আনসাপোর্টেড অ্যাপ ইনস্টল",
        offlineFlash: "সফটওয়্যার ফ্ল্যাশ",
        offlineDelete: "সিস্টেম অ্যাপ ডিলিট",
        offlineKernel: "কাস্টম কার্নেল ইনস্টল",
        offlineInstallOS: "ফোনে ওএস ইনস্টল",
        offlineMore: "এবং আরও অনেক...",
        footerTitle: "যোগাযোগ করুন",
        footerSubtitle: "আপডেটের জন্য আমাদের পেজ ফলো করুন অথবা সরাসরি WhatsApp বা Messenger-এ যোগাযোগ করুন।",
        footerBtnPage: "আমাদের পেজ ভিজিট করুন",
        footerBtnWhatsapp: "WhatsApp-এ চ্যাট করুন",
        footerBtnMessenger: "ফেসবুকে মেসেজ দিন",
        footerPrivacy: "গোপনীয়তা ও আইনি তথ্য",
        footerCopyright: "© ২০২৫ ডিজিফিক্স বিডি। সর্বস্বত্ব সংরক্ষিত।",
        chatHeader: "এআই অ্যাসিস্ট্যান্ট",
        chatPlaceholder: "আপনার মেসেজ লিখুন...",
        chatInitialQuestion: "হ্যালো! আমি ডিজিফিক্স বিডি-এর এআই অ্যাসিস্ট্যান্ট। আজ আপনি কোন সার্ভিসটি খুঁজছেন?",
        chatLiveAgentQuery: "এই তথ্যটি কি আপনার জন্য সহায়ক ছিল? আপনি কি সরাসরি একজন লাইভ এজেন্টের সাথে কথা বলতে চান?",
        chatYes: "হ্যাঁ",
        chatNo: "না",
        chatContactInfo: "চমৎকার! আপনি আমাদের সাথে সরাসরি যোগাযোগ করতে পারেন:",
        chatThanks: "আপনাকে স্বাগতম! আপনার যদি অন্য কোনো প্রশ্ন থাকে, তবে জিজ্ঞাসা করতে পারেন।",
        geminiError: "কোনো একটি সমস্যা হয়েছে। দয়া করে, কিছুক্ষণ পর আবার চেষ্টা করুন।",
    }
};
// --- LANGUAGE SWITCHER LOGIC ---
const languageSwitcher = document.getElementById('language-switcher');
const translatableElements = document.querySelectorAll('[data-translate-key]');
const setLanguage = (lang) => {
    translatableElements.forEach(el => {
        const key = el.getAttribute('data-translate-key');
        const translation = translations[lang][key];
        if (translation !== undefined) {
            if (el.tagName === 'META' && el.name === 'description') {
                el.setAttribute('content', translation);
            } else if (el.tagName === 'TITLE') {
                el.textContent = translation;
            } else if (el.hasAttribute('placeholder')) {
                el.setAttribute('placeholder', translation);
            }
            else {
                el.innerHTML = translation;
            }
        }
    });
    document.documentElement.lang = lang;
    localStorage.setItem('language', lang);
    languageSwitcher.value = lang;
};
languageSwitcher.addEventListener('change', (event) => {
    setLanguage(event.target.value);
});
document.addEventListener('DOMContentLoaded', () => {
    const savedLang = localStorage.getItem('language');
    const browserLang = navigator.language.split('-')[0];
    const defaultLang = (browserLang === 'bn' && !savedLang) ? 'bn' : 'en';
    const langToSet = savedLang || defaultLang;
    setLanguage(langToSet);
    initializeChatbot();
});
// --- CHATBOT & GEMINI API LOGIC ---
const chatToggleBtn = document.getElementById('chat-toggle-btn');
const chatWindow = document.getElementById('chat-window');
const chatMessages = document.getElementById('chat-messages');
const chatInput = document.getElementById('chat-input');
const chatSendBtn = document.getElementById('chat-send-btn');
function initializeChatbot() {
    chatToggleBtn.addEventListener('click', () => {
        chatWindow.classList.toggle('active');
        if (chatWindow.classList.contains('active') && chatMessages.children.length === 0) {
            const currentLang = localStorage.getItem('language') || 'en';
            addMessage(translations[currentLang].chatInitialQuestion, 'bot');
        }
    });
}
function addMessage(text, sender, isHTML = false) {
    const messageContainer = document.createElement('div');
    messageContainer.className = `chat-message ${sender}`;
    const messageBubble = document.createElement('div');
    messageBubble.className = 'message-bubble';
    if (isHTML) {
        messageBubble.innerHTML = text;
    } else {
        messageBubble.textContent = text;
    }
    messageContainer.appendChild(messageBubble);
    chatMessages.appendChild(messageContainer);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

function showTypingIndicator() {
    const typingDiv = document.createElement('div');
    typingDiv.className = 'chat-message bot';
    typingDiv.id = 'typing-indicator';
    typingDiv.innerHTML = `<div class="message-bubble typing-indicator">...</div>`;
    chatMessages.appendChild(typingDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}
function removeTypingIndicator() {
    const indicator = document.getElementById('typing-indicator');
    if (indicator) indicator.remove();
}
function handleAgentChoice(choice) {
    const buttons = document.querySelectorAll('.chat-button');
    buttons.forEach(button => {
        button.disabled = true;
        button.style.cursor = 'not-allowed';
        button.style.backgroundColor = '#d1d5db';
    });
    const currentLang = localStorage.getItem('language') || 'en';
    if (choice === 'yes') {
        const contactText = translations[currentLang].chatContactInfo;
        const whatsappBtnText = translations[currentLang].heroBtnWhatsapp;
        const messengerBtnText = translations[currentLang].heroBtnMessenger;
        const contactHtml = `
            ${contactText}<br><br>
            <a href="https://wa.me/16506687797" target="_blank" class="cta-button whatsapp-btn text-sm" style="text-decoration: none;">
                <i class="fab fa-whatsapp mr-2"></i> ${whatsappBtnText}
            </a>
            <a href="https://m.me/tanjim.ahmmed.shuvo" target="_blank" class="cta-button messenger-btn text-sm" style="text-decoration: none;">
                <i class="fab fa-facebook-messenger mr-2"></i> ${messengerBtnText}
            </a>
        `;
        addMessage(contactHtml, 'bot', true);
    } else {
        const thanksText = translations[currentLang].chatThanks;
        addMessage(thanksText, 'bot');
    }
}

async function handleSendMessage() {
    const userQuery = chatInput.value;
    if (!userQuery.trim()) return;
    addMessage(userQuery, 'user');
    chatInput.value = '';
    showTypingIndicator();
    
    const allServices = `
        Online Services: Facebook Meta Verified, Instagram + Threads Verified, Facebook Page Verification, Business Manager Verification, Ads Account Verification, WhatsApp Business Verification, Running Verification, Facebook Locked ID Unlock, Payout Transfer/Restriction/Disabled Fix, Payment Disabled Issue Fix (Ads Account / Meta Payment), Facebook Ads 15% VAT/TAX Saving BIN, Ads Campaign Setup & Boosting Service, Suspended ID Recovery.
        Subscriptions: Netflix, Telegram, Twitter (X), Google AI Pro, ChatGPT Plus, YouTube Premium, Watch Time, VPN, Paid Software.
        Other: RDP, Paid Tutorials, Mini Android app dev, WIFI BDIX Proxy.
        Offline (Android): Dead Phone Repair, CPU Overclock, Root, OS Upgrade, Bootloop Fix, Boot animation Change, Lock Unlock, FRP bypass, Custom os install, Not supported app install, Software Flash, Delete system app, Custom kernel install, Windows/Linux/Mac os install.
    `;
    const prompt = `
        You are a friendly and helpful assistant for 'Digifix BD'.
        A user has sent a message: "${userQuery}".
        FIRST, detect the language of the user's message. It will be one of three: English, Bangla (in Bengali script like 'আমার নেটফ্লিক্স লাগবে'), or Banglish (Bangla written in Latin script like 'amar netflix lagbe').
        SECOND, based on the user's query, recommend the most relevant service(s) from the list below.
        - If a service matches, explain why it's a good fit.
        - If no service matches, politely say so and suggest they can still ask for it.
        THIRD, and MOST IMPORTANTLY, you MUST write your entire response in the SAME language and script you detected.
        - If the user wrote in English, respond in English.
        - If the user wrote in বাংলা, respond in বাংলা.
        - If the user wrote in Banglish, respond in Banglish.
        
        Do not add any introductory or concluding remarks that are not part of the direct answer. Just provide the service recommendation.
        
        Available services:
        ${allServices}
    `;
    try {
        let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
        const payload = { contents: chatHistory };
        const apiKey = "AIzaSyBPkQ_en57ffDtjhTG41zdI3nV6zeKiwZ4";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
        
        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
        if (!response.ok) throw new Error(`API request failed with status ${response.status}`);
        const result = await response.json();
        
        const currentLang = localStorage.getItem('language') || 'en';
        let text = translations[currentLang].geminiError;
        if (result.candidates && result.candidates[0]?.content?.parts?.[0]?.text) {
            text = result.candidates[0].content.parts[0].text;
        }
        
        removeTypingIndicator();
        addMessage(text.replace(/\n/g, '<br>'), 'bot', true);
        
        setTimeout(() => {
            const liveAgentQuery = translations[currentLang].chatLiveAgentQuery;
            const yesText = translations[currentLang].chatYes;
            const noText = translations[currentLang].chatNo;
            const agentQueryHtml = `
                ${liveAgentQuery}<br>
                <button class="chat-button" onclick="handleAgentChoice('yes')">${yesText}</button>
                <button class="chat-button" onclick="handleAgentChoice('no')">${noText}</button>
            `;
            addMessage(agentQueryHtml, 'bot', true);
        }, 1000);
    } catch (error) {
        console.error("Gemini API Error:", error);
        removeTypingIndicator();
        const currentLang = localStorage.getItem('language') || 'en';
        addMessage(translations[currentLang].geminiError, 'bot');
    }
}
chatSendBtn.addEventListener('click', handleSendMessage);
chatInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        handleSendMessage();
    }
});
